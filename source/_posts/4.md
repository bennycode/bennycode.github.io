---
title: Run Node.js apps on Heroku 
date: 2019/3/19 12:15:32
categories:
  - [Node.js]
tags:
  - heroku
  - cli
  - setup
  - hosting
  - paas
---

## Getting Started on Heroku

The best way to get started on the Heroku polyglot platform is to follow their [fantastic introduction](https://devcenter.heroku.com/articles/getting-started-with-nodejs#introduction). It's also worth reading about their [supported environments](https://devcenter.heroku.com/articles/buildpacks), [deployment tasks](https://devcenter.heroku.com/articles/procfile) and [European deployment](https://blog.heroku.com/europe-region) region.

To speed things a little bit up, I am providing a list of resources which I found useful when deploying my first Node.js web applications on Heroku.

## Bootstrap Node.js environment

1. Download the [Heroku CLI](https://devcenter.heroku.com/articles/heroku-cli) (or [Heroku Toolbelt](https://blog.heroku.com/the_heroku_toolbelt))
1. Run `heroku --version` to see if it works (I tested with v6.15.5)
1. Run `heroku login`
1. Run `heroku whoami` to see if you are logged in
1. Run `heroku create --region eu --buildpack heroku/nodejs` to create a Node.js app on Heroku in a European data center (your app will get a URL like `https://app-name-number.herokuapp.com/`)
1. Run `heroku open -a app-name-number` to see your application in a browser

## Connect Git repository

By default web applications created on Heroku (with `heroku create`) come with their own Git repository. If you are starting completely from scratch, then you can follow these steps to push your own code to Heroku's Git repository:

```bash
git init
git remote add origin https://git.heroku.com/app-name-number.git
npm init -y
git add .
git commit -m "Initial commit"
git push -u origin master
```

If you now execute `heroku open`, you will see an "Application error" because you need to specify a way to start a Node.js process (most likely through `npm start`). 

Note: Heroku will also run `npm run build` by default before running `npm start`.

## Write Node.js application

When `npm init -y` was executed, a `package.json` file has been created. We will make some adjustments to that file and create a web application based on the [Express](http://expressjs.com/) web framework:

1. Run `npm i --save-dev typescript`
1. Run `npm i --save express @types/express`
1. Run `npx tsc --init`
1. Modify source code to match the following files.

**package.json**

```json
{
  "dependencies": {
    "@types/express": "4.16.1",
    "express": "4.16.4"
  },
  "devDependencies": {
    "typescript": "3.3.3333"
  },
  "engines": {
    "node": "11.x.x"
  },
  "license": "ISC",
  "main": "dist/main.js",
  "name": "my-app",
  "repository": {
    "type": "git",
    "url": "https://git.heroku.com/app-name-number.git"
  },
  "scripts": {
    "build": "tsc --build tsconfig.json",
    "start": "node dist/main.js"
  },
  "version": "1.0.0"
}
```

**src/main.ts**

```ts
import express from 'express';

const pkg = require('../package.json');
const app = express();

app.set('port', process.env.PORT || 3000);

app.all('*', (request, response) => {
  response.send(`<b>${pkg.name} v${pkg.version}</b>`);
});

app.listen(app.get('port'), () => {
  console.log(`Server is running on port "${app.get('port')}".`);
});
```

Deploy latest code changes:

```bash
git add .
git commit -m "Show app version"
git push
```

## Connect GitHub repository

To run deployments from your GitHub repository, you need to add Heroku's Git repository to your cloned GitHub repository:

```bash
# Add remote named "heroku"
git remote add heroku https://git.heroku.com/app-name-number.git

# Push to "master" branch on remote "heroku"
git push heroku master
``` 

