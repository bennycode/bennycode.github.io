---
title: TypeScript code coverage with Karma
date: 2019/4/29 16:53:35
categories:
  - [TypeScript, Setup]
tags:
  - karma
  - webpack
  - babel
  - typescript
  - istanbul
  - coverage
---

## Baseline

- Node.js v10.9.0
- yarn v1.15.2

{% codeblock lang:json package.json %}
{
  "devDependencies": {
    "jasmine": "3.4.0"
  },
  "main": "src/main.js",
  "name": "karma-webpack-babel-typescript-istanbul",
  "scripts": {
    "start": "node index.js",
    "test": "jasmine --config=jasmine.json"
  },
  "version": "0.0.0"
}
{% endcodeblock %}

{% codeblock lang:json jasmine.json %}
{
  "random": true,
  "spec_dir": "src",
  "spec_files": [
    "**/*test.js"
  ],
  "stopSpecOnExpectationFailure": true
}
{% endcodeblock %}

{% codeblock lang:js index.js %}
const afterTwoSeconds = require('./src/main');

afterTwoSeconds(() => {
  console.log('I will be called after 2 seconds.');
});
{% endcodeblock %}

{% codeblock lang:js src/main.js %}
module.exports = function afterTwoSeconds(callback) {
  return new Promise((resolve) => {
    setTimeout(() => {
      callback();
      resolve();
    }, 2000);
  });
};
{% endcodeblock %}

{% codeblock lang:js src/main.test.js %}
const afterTwoSeconds = require('./main');

describe('afterTwoSeconds', () => {
  it('resolves after 2 seconds', async () => {
    const myCallbackSpy = jasmine.createSpy('myCallbackSpy');
    await afterTwoSeconds(myCallbackSpy);
    expect(myCallbackSpy).toHaveBeenCalled();
  });
});
{% endcodeblock %}

## Add Karma

{% codeblock lang:json mark:4 package.json %}
{
  "devDependencies": {
    "jasmine": "3.4.0",
    "karma": "4.1.0"
  },
  "main": "src/main.js",
  "name": "karma-webpack-babel-typescript-istanbul",
  "scripts": {
    "start": "node index.js",
    "test": "jasmine --config=jasmine.json"
  },
  "version": "0.0.0"
}
{% endcodeblock %}