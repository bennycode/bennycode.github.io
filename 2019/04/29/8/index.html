<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>TypeScript code coverage with Karma | Benny&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Baseline Node.js v10.9.0 yarn v1.15.2  package.json123456789101112&amp;#123;  &quot;devDependencies&quot;: &amp;#123;    &quot;jasmine&quot;: &quot;3.4.0&quot;  &amp;#125;,  &quot;main&quot;: &quot;src/main.js&quot;,  &quot;name&quot;: &quot;karma-webpack-babel-typescript-ista">
<meta name="keywords" content="coverage,istanbul,babel,typescript,webpack,karma,preprocessor">
<meta property="og:type" content="article">
<meta property="og:title" content="TypeScript code coverage with Karma">
<meta property="og:url" content="https://benny.work/2019/04/29/8/index.html">
<meta property="og:site_name" content="Benny&#39;s Blog">
<meta property="og:description" content="Baseline Node.js v10.9.0 yarn v1.15.2  package.json123456789101112&amp;#123;  &quot;devDependencies&quot;: &amp;#123;    &quot;jasmine&quot;: &quot;3.4.0&quot;  &amp;#125;,  &quot;main&quot;: &quot;src/main.js&quot;,  &quot;name&quot;: &quot;karma-webpack-babel-typescript-ista">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2019-05-02T15:12:09.388Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="TypeScript code coverage with Karma">
<meta name="twitter:description" content="Baseline Node.js v10.9.0 yarn v1.15.2  package.json123456789101112&amp;#123;  &quot;devDependencies&quot;: &amp;#123;    &quot;jasmine&quot;: &quot;3.4.0&quot;  &amp;#125;,  &quot;main&quot;: &quot;src/main.js&quot;,  &quot;name&quot;: &quot;karma-webpack-babel-typescript-ista">
  
    <link rel="alternate" href="/atom.xml" title="Benny&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Benny&#39;s Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://benny.work"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-8" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/29/8/" class="article-date">
  <time datetime="2019-04-29T14:53:35.000Z" itemprop="datePublished">2019-04-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/TypeScript/">TypeScript</a>►<a class="article-category-link" href="/categories/TypeScript/Setup/">Setup</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      TypeScript code coverage with Karma
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Baseline"><a href="#Baseline" class="headerlink" title="Baseline"></a>Baseline</h2><ul>
<li>Node.js v10.9.0</li>
<li>yarn v1.15.2</li>
</ul>
<figure class="highlight json"><figcaption><span>package.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"devDependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"jasmine"</span>: <span class="string">"3.4.0"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"main"</span>: <span class="string">"src/main.js"</span>,</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"karma-webpack-babel-typescript-istanbul"</span>,</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"start"</span>: <span class="string">"node index.js"</span>,</span><br><span class="line">    <span class="attr">"test"</span>: <span class="string">"jasmine --config=jasmine.json"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"0.0.0"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight json"><figcaption><span>jasmine.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"random"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"spec_dir"</span>: <span class="string">"src"</span>,</span><br><span class="line">  <span class="attr">"spec_files"</span>: [</span><br><span class="line">    <span class="string">"**/*test.js"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"stopSpecOnExpectationFailure"</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><figcaption><span>index.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> afterTwoSeconds = <span class="built_in">require</span>(<span class="string">'./src/main'</span>);</span><br><span class="line"></span><br><span class="line">afterTwoSeconds(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'I will be called after 2 seconds.'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><figcaption><span>src/main.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> <span class="title">afterTwoSeconds</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      callback();</span><br><span class="line">      resolve();</span><br><span class="line">    &#125;, <span class="number">2000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><figcaption><span>src/main.test.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> afterTwoSeconds = <span class="built_in">require</span>(<span class="string">'./main'</span>);</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'afterTwoSeconds'</span>, () =&gt; &#123;</span><br><span class="line">  it(<span class="string">'resolves after 2 seconds'</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> myCallbackSpy = jasmine.createSpy(<span class="string">'myCallbackSpy'</span>);</span><br><span class="line">    <span class="keyword">await</span> afterTwoSeconds(myCallbackSpy);</span><br><span class="line">    expect(myCallbackSpy).toHaveBeenCalled();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="Add-Karma"><a href="#Add-Karma" class="headerlink" title="Add Karma"></a>Add Karma</h2><h3 id="Update-dependencies"><a href="#Update-dependencies" class="headerlink" title="Update dependencies"></a>Update dependencies</h3><p>Karma needs an <a href="https://npmjs.org/browse/keyword/karma-adapter" target="_blank" rel="noopener">adapter</a> to know about the Jasmine testing framework. It also needs a <a href="https://npmjs.org/browse/keyword/karma-launcher" target="_blank" rel="noopener">browser launcher</a> to run the tests within a browser environment.</p>
<figure class="highlight json"><figcaption><span>package.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"devDependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"jasmine"</span>: <span class="string">"3.4.0"</span>,</span><br><span class="line marked">    <span class="attr">"karma"</span>: <span class="string">"4.1.0"</span>,</span><br><span class="line marked">    <span class="attr">"karma-chrome-launcher"</span>: <span class="string">"2.2.0"</span>,</span><br><span class="line marked">    <span class="attr">"karma-jasmine"</span>: <span class="string">"2.0.1"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"main"</span>: <span class="string">"src/main.js"</span>,</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"karma-webpack-babel-typescript-istanbul"</span>,</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"start"</span>: <span class="string">"node index.js"</span>,</span><br><span class="line marked">    <span class="attr">"test"</span>: <span class="string">"karma start"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"0.0.0"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Update-export"><a href="#Update-export" class="headerlink" title="Update export"></a>Update export</h3><p>Karma will run the tests inside the operating system’s Chrome browser which was in my case Chrome v74. The browser environment does not know about <code>module.exports</code>, so we will use the <code>window</code> namespace to export our <code>afterTwoSeconds</code> function:</p>
<figure class="highlight js"><figcaption><span>src/main.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">afterTwoSeconds</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      callback();</span><br><span class="line">      resolve();</span><br><span class="line">    &#125;, <span class="number">2000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line marked"><span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">module</span> !== <span class="string">'undefined'</span> &amp;&amp; <span class="keyword">typeof</span> <span class="built_in">module</span>.exports !== <span class="string">'undefined'</span>) &#123;</span><br><span class="line marked">  <span class="built_in">module</span>.exports = afterTwoSeconds;</span><br><span class="line marked">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line marked">  <span class="built_in">window</span>.afterTwoSeconds = afterTwoSeconds;</span><br><span class="line marked">&#125;</span><br></pre></td></tr></table></figure>
<p>Note: We still export our code for Node.js environments, to make our code work in both worlds. That’s why we keep <a href="https://nodejs.org/dist/latest-v10.x/docs/api/timers.html#timers_settimeout_callback_delay_args" target="_blank" rel="noopener">setTimeout</a> because it is available in Node.js and browser environments. If we would write <code>window.setTimeout</code> it would only work in browsers but fail in Node.js. </p>
<h3 id="Update-test"><a href="#Update-test" class="headerlink" title="Update test"></a>Update test</h3><p>Our tests will run in the browser so we cannot import code with a <code>require</code> statement (CommonJS syntax) anymore and need to use the <code>window</code> namespace:</p>
<figure class="highlight js"><figcaption><span>src/main.test.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">describe(<span class="string">'afterTwoSeconds'</span>, () =&gt; &#123;</span><br><span class="line">  it(<span class="string">'resolves after 2 seconds'</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> myCallbackSpy = jasmine.createSpy(<span class="string">'myCallbackSpy'</span>);</span><br><span class="line marked">    <span class="keyword">await</span> <span class="built_in">window</span>.afterTwoSeconds(myCallbackSpy);</span><br><span class="line">    expect(myCallbackSpy).toHaveBeenCalled();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="Add-Karma-configuration"><a href="#Add-Karma-configuration" class="headerlink" title="Add Karma configuration"></a>Add Karma configuration</h3><p>A Karma configuration can be interactively created by running <code>npx karma init</code>. In our case we reuse the file paths from our Jasmine configuration.</p>
<p>For a successful Karma test run it is important to declare the source code and test code within the <code>files</code> property.</p>
<p>Karma can be equipped with a custom <a href="https://npmjs.org/browse/keyword/karma-reporter" target="_blank" rel="noopener">test reporter</a> but for now we are good with the standard <code>progress</code> reporter:</p>
<figure class="highlight js"><figcaption><span>karma.conf.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> jasmineConfig = <span class="built_in">require</span>(<span class="string">'./jasmine.json'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">config</span>) </span>&#123;</span><br><span class="line">  config.set(&#123;</span><br><span class="line">    autoWatch: <span class="literal">false</span>,</span><br><span class="line">    basePath: jasmineConfig.spec_dir,</span><br><span class="line">    browsers: [<span class="string">'Chrome'</span>],</span><br><span class="line">    colors: <span class="literal">true</span>,</span><br><span class="line">    concurrency: <span class="literal">Infinity</span>,</span><br><span class="line">    exclude: [],</span><br><span class="line">    files: [</span><br><span class="line">      <span class="string">'main.js'</span>,</span><br><span class="line">      ...jasmineConfig.spec_files</span><br><span class="line">    ],</span><br><span class="line">    frameworks: [<span class="string">'jasmine'</span>],</span><br><span class="line">    logLevel: config.LOG_INFO,</span><br><span class="line">    port: <span class="number">9876</span>,</span><br><span class="line">    preprocessors: &#123;&#125;,</span><br><span class="line">    reporters: [<span class="string">'progress'</span>],</span><br><span class="line">    singleRun: <span class="literal">true</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="Add-Webpack"><a href="#Add-Webpack" class="headerlink" title="Add Webpack"></a>Add Webpack</h2><h3 id="Update-dependencies-1"><a href="#Update-dependencies-1" class="headerlink" title="Update dependencies"></a>Update dependencies</h3><p>We need to add <code>webpack-karma</code> so that Karma can use <code>webpack</code> to preprocess files. This also requires us to include <code>webpack</code> in our list of dependencies as it is a peer dependency of <code>webpack-karma</code>:</p>
<figure class="highlight json"><figcaption><span>package.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"devDependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"jasmine"</span>: <span class="string">"3.4.0"</span>,</span><br><span class="line">    <span class="attr">"karma"</span>: <span class="string">"4.1.0"</span>,</span><br><span class="line">    <span class="attr">"karma-chrome-launcher"</span>: <span class="string">"2.2.0"</span>,</span><br><span class="line">    <span class="attr">"karma-jasmine"</span>: <span class="string">"2.0.1"</span>,</span><br><span class="line marked">    <span class="attr">"karma-webpack"</span>: <span class="string">"3.0.5"</span>,</span><br><span class="line marked">    <span class="attr">"webpack"</span>: <span class="string">"4.30.0"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"main"</span>: <span class="string">"src/main.js"</span>,</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"karma-webpack-babel-typescript-istanbul"</span>,</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"start"</span>: <span class="string">"node index.js"</span>,</span><br><span class="line">    <span class="attr">"test"</span>: <span class="string">"karma start"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"0.0.0"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Common mistake</strong></p>
<blockquote>
<p>ERROR [preprocess]: Can not load “webpack”, it is not registered!<br>Perhaps you are missing some plugin?</p>
</blockquote>
<p>This happens when you run <code>karma start</code> and you forgot to install <code>webpack</code>.</p>
<h3 id="Add-Webpack-configuration"><a href="#Add-Webpack-configuration" class="headerlink" title="Add Webpack configuration"></a>Add Webpack configuration</h3><p>Thanks to webpack’s zero configuration mode and its default settings, we don’t need to specify much. All we do is defining a “development” mode to get detailed messages in case of preprocessing errors:  </p>
<figure class="highlight js"><figcaption><span>webpack.config.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  mode: <span class="string">'development'</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>Using a “development” mode will decrypt error messages like <code>TypeError: r is not a function</code>.</p>
<h3 id="Update-Karma-configuration"><a href="#Update-Karma-configuration" class="headerlink" title="Update Karma configuration"></a>Update Karma configuration</h3><p>In the previous Karma setup, our test code was relying that our business logic is exposed to the <code>window</code> namespace (<code>window.afterTwoSeconds</code>). Having webpack in place we will now load our business logic through our test code. That’s why we don’t need to declare our business logic anymore within Karma’s <code>files</code> pattern. It’s sufficient if we just point Karma to our test code because the tests will import the main source code for us. We can also reuse our webpack configuration by requiring it. To activate webpack, we need to declare it as a preprocessor for our test code. We also need to add the webpack configuration to our Karma configuration:</p>
<figure class="highlight js"><figcaption><span>karma.conf.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line marked"><span class="keyword">const</span> testCode = <span class="string">'src/**/*test.js'</span>;</span><br><span class="line marked"><span class="keyword">const</span> webpackConfig = <span class="built_in">require</span>(<span class="string">'./webpack.config.js'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">config</span>) </span>&#123;</span><br><span class="line">  config.set(&#123;</span><br><span class="line">    autoWatch: <span class="literal">false</span>,</span><br><span class="line marked">    basePath: <span class="string">''</span>,</span><br><span class="line">    browsers: [<span class="string">'Chrome'</span>],</span><br><span class="line">    colors: <span class="literal">true</span>,</span><br><span class="line">    concurrency: <span class="literal">Infinity</span>,</span><br><span class="line">    exclude: [],</span><br><span class="line marked">    files: [</span><br><span class="line marked">      &#123;<span class="attr">pattern</span>: testCode, <span class="attr">watched</span>: <span class="literal">false</span>&#125;</span><br><span class="line marked">    ],</span><br><span class="line">    frameworks: [<span class="string">'jasmine'</span>],</span><br><span class="line">    logLevel: config.LOG_INFO,</span><br><span class="line">    port: <span class="number">9876</span>,</span><br><span class="line marked">    preprocessors: &#123;</span><br><span class="line marked">      [testCode]: [<span class="string">'webpack'</span>]</span><br><span class="line marked">    &#125;,</span><br><span class="line">    reporters: [<span class="string">'progress'</span>],</span><br><span class="line">    singleRun: <span class="literal">true</span>,</span><br><span class="line marked">    webpack: webpackConfig</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="Update-imports"><a href="#Update-imports" class="headerlink" title="Update imports"></a>Update imports</h3><p>Our test code will now be preprocessed by webpack which means that we can use Node.js features like <code>require</code> statements to import code. Webpack will make sure that the <code>require</code> statements get processed into something that can be understood by our Browser environment:</p>
<figure class="highlight js"><figcaption><span>karma.conf.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line marked"><span class="keyword">const</span> afterTwoSeconds = <span class="built_in">require</span>(<span class="string">'./main'</span>);</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'afterTwoSeconds'</span>, () =&gt; &#123;</span><br><span class="line">  it(<span class="string">'resolves after 2 seconds'</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> myCallbackSpy = jasmine.createSpy(<span class="string">'myCallbackSpy'</span>);</span><br><span class="line marked">    <span class="keyword">await</span> afterTwoSeconds(myCallbackSpy);</span><br><span class="line">    expect(myCallbackSpy).toHaveBeenCalled();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="Add-Babel"><a href="#Add-Babel" class="headerlink" title="Add Babel"></a>Add Babel</h2><p>…</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://benny.work/2019/04/29/8/" data-id="cjv6sgqkt003lqw9o9mogs5ed" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/babel/">babel</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/coverage/">coverage</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/istanbul/">istanbul</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/karma/">karma</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/preprocessor/">preprocessor</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/typescript/">typescript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/webpack/">webpack</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2019/04/26/7/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">You might not need aliases</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Electron/">Electron</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Electron/Basics/">Basics</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Electron/Testing/">Testing</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Electron/Testing/Code-Coverage/">Code Coverage</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Electron/Testing/Unit-Testing/">Unit Testing</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Node-js/">Node.js</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Node-js/CLI/">CLI</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Node-js/Hosting/">Hosting</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/TypeScript/">TypeScript</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/TypeScript/Setup/">Setup</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/TypeScript/Type-Definitions/">Type Definitions</a></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ECMAScript-2015/">ECMAScript 2015</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ECMAScript-6/">ECMAScript 6</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ECMAScript-Harmony/">ECMAScript Harmony</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ES2015/">ES2015</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ES6/">ES6</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Node-js/">Node.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TS2339/">TS2339</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TypeScript/">TypeScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/alias/">alias</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/args/">args</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/argv/">argv</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/babel/">babel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/babel-plugin-istanbul/">babel-plugin-istanbul</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cli/">cli</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/coverage/">coverage</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/electron/">electron</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/electron-mocha/">electron-mocha</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/express/">express</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/global/">global</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/heroku/">heroku</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hosting/">hosting</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/istanbul/">istanbul</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/karma/">karma</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/libraries/">libraries</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/main/">main</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mocha/">mocha</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/namespace/">namespace</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nodejs/">nodejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/npm/">npm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/paas/">paas</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/packages/">packages</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/preprocessor/">preprocessor</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/preset-typescript/">preset-typescript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/process/">process</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/renderer/">renderer</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/resolve/">resolve</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/setup/">setup</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tools/">tools</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tsc/">tsc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/typescript/">typescript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webpack/">webpack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/window/">window</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/ECMAScript-2015/" style="font-size: 10px;">ECMAScript 2015</a> <a href="/tags/ECMAScript-6/" style="font-size: 10px;">ECMAScript 6</a> <a href="/tags/ECMAScript-Harmony/" style="font-size: 10px;">ECMAScript Harmony</a> <a href="/tags/ES2015/" style="font-size: 10px;">ES2015</a> <a href="/tags/ES6/" style="font-size: 10px;">ES6</a> <a href="/tags/Node-js/" style="font-size: 10px;">Node.js</a> <a href="/tags/TS2339/" style="font-size: 10px;">TS2339</a> <a href="/tags/TypeScript/" style="font-size: 15px;">TypeScript</a> <a href="/tags/alias/" style="font-size: 10px;">alias</a> <a href="/tags/args/" style="font-size: 10px;">args</a> <a href="/tags/argv/" style="font-size: 10px;">argv</a> <a href="/tags/babel/" style="font-size: 20px;">babel</a> <a href="/tags/babel-plugin-istanbul/" style="font-size: 10px;">babel-plugin-istanbul</a> <a href="/tags/cli/" style="font-size: 15px;">cli</a> <a href="/tags/coverage/" style="font-size: 20px;">coverage</a> <a href="/tags/electron/" style="font-size: 10px;">electron</a> <a href="/tags/electron-mocha/" style="font-size: 15px;">electron-mocha</a> <a href="/tags/express/" style="font-size: 10px;">express</a> <a href="/tags/global/" style="font-size: 10px;">global</a> <a href="/tags/heroku/" style="font-size: 10px;">heroku</a> <a href="/tags/hosting/" style="font-size: 10px;">hosting</a> <a href="/tags/istanbul/" style="font-size: 15px;">istanbul</a> <a href="/tags/javascript/" style="font-size: 10px;">javascript</a> <a href="/tags/karma/" style="font-size: 10px;">karma</a> <a href="/tags/libraries/" style="font-size: 10px;">libraries</a> <a href="/tags/main/" style="font-size: 10px;">main</a> <a href="/tags/mocha/" style="font-size: 15px;">mocha</a> <a href="/tags/namespace/" style="font-size: 10px;">namespace</a> <a href="/tags/nodejs/" style="font-size: 10px;">nodejs</a> <a href="/tags/npm/" style="font-size: 10px;">npm</a> <a href="/tags/paas/" style="font-size: 10px;">paas</a> <a href="/tags/packages/" style="font-size: 20px;">packages</a> <a href="/tags/preprocessor/" style="font-size: 10px;">preprocessor</a> <a href="/tags/preset-typescript/" style="font-size: 10px;">preset-typescript</a> <a href="/tags/process/" style="font-size: 10px;">process</a> <a href="/tags/renderer/" style="font-size: 10px;">renderer</a> <a href="/tags/resolve/" style="font-size: 10px;">resolve</a> <a href="/tags/setup/" style="font-size: 10px;">setup</a> <a href="/tags/tools/" style="font-size: 10px;">tools</a> <a href="/tags/tsc/" style="font-size: 15px;">tsc</a> <a href="/tags/typescript/" style="font-size: 15px;">typescript</a> <a href="/tags/webpack/" style="font-size: 15px;">webpack</a> <a href="/tags/window/" style="font-size: 10px;">window</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/04/29/8/">TypeScript code coverage with Karma</a>
          </li>
        
          <li>
            <a href="/2019/04/26/7/">You might not need aliases</a>
          </li>
        
          <li>
            <a href="/2019/04/16/6/">Anatomy of an Electron 4 application</a>
          </li>
        
          <li>
            <a href="/2019/04/08/5/">Setup TypeScript code coverage for Electron applications</a>
          </li>
        
          <li>
            <a href="/2019/03/19/4/">Run Node.js apps on Heroku</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Benny Neugebauer<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>